import pandas as pd
import numpy as np
import csv
from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import GradientBoostingClassifier
from sklearn import cross_validation

train_df = pd.read_csv(r'submissions\asm_train2.csv', header = 0)
test_df = pd.read_csv(r'submissions\asm_test2.csv', header = 0)

y = train_df['Class'].values
train_df = train_df.drop(['Class', 'Id'], axis=1)
train_data = train_df.values

Ids = test_df['Id'].values
test_df = test_df.drop(['Id'], axis=1)
test_data = test_df.values

print 'Training...'
##forest = RandomForestClassifier(n_estimators = 400)
forest2 = GradientBoostingClassifier(n_estimators=300, verbose=1,
                                    learning_rate = 0.15, max_depth=3)
##forest = forest.fit(train_data, y)
forest2 = forest2.fit(train_data, y)

print 'Predicting...'
##output1 = forest.predict_proba(test_data)
output = forest2.predict_proba(test_data)

##output = []
##for t, row in enumerate(output1):
##    tmp = np.vstack([output1[t], output2[t]])
##    tmp = np.average(tmp, axis = 0)
##    output.append(tmp)
##output = np.array(output)

predictions_file = open("submission.csv", "wb")
open_file_object = csv.writer(predictions_file)
open_file_object.writerow(['Id', 'Prediction1', 'Prediction2', 'Prediction3',
                           'Prediction4', 'Prediction5', 'Prediction6',
                           'Prediction7', 'Prediction8', 'Prediction9'])

for t, row in enumerate(Ids):
    s = []
    s.append(row)
    s.extend(output[t])
    open_file_object.writerow(s)
predictions_file.close()
print 'Done.'
