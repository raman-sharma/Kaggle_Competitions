import csv
import sys
sys.path.append('/home/yejiming/xgboost/wrapper')
import xgboost as xgb
import pandas as pd
from sklearn import preprocessing

train_df = pd.read_csv(r'submissions/asm_train2.csv', header = 0)
test_df = pd.read_csv(r'submissions/asm_test2.csv', header = 0)

y = train_df['Class'].values
train_df = train_df.drop(['Class', 'Id'], axis=1)
train_data = train_df.values

lbl_enc = preprocessing.LabelEncoder()
y = lbl_enc.fit_transform(y)

Ids = test_df['Id'].values
test_df = test_df.drop(['Id'], axis=1)
test_data = test_df.values

dtrain = xgb.DMatrix(train_data, label = y)
dtest = xgb.DMatrix(test_data)

param = {'objective':'multi:softprob', 'num_class':9, 'nthread':8,
         'eval_metric':'mlogloss', 'bst:max_depth':10,
         'bst:min_child_weight':1, 'bst:subsample':0.7,
         'bst:colsample_bytree':0.8, 'bst:eta':0.05}

num_round = 500
print 'Training...'
bst = xgb.cv(param, dtrain, num_round, nfold = 5)
##bst = xgb.train(param, dtrain, num_round)
##
##print 'Predicting...'
##preds = bst.predict(dtest)
##
##predictions_file = open("submissions/submission1.csv", "wb")
##open_file_object = csv.writer(predictions_file)
##open_file_object.writerow(['Id', 'Prediction1', 'Prediction2', 'Prediction3',
##                           'Prediction4', 'Prediction5', 'Prediction6',
##                           'Prediction7', 'Prediction8', 'Prediction9'])
##for t, row in enumerate(Ids):
##    s = []
##    s.append(row)
##    s.extend(preds[t])
##    open_file_object.writerow(s)
##predictions_file.close()
##print 'Done.'
    
